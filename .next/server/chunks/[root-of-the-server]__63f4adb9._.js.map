{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Abdel/Desktop/ENIAD-ASSISTANT/config/db.js"],"sourcesContent":["import mongoose from \"mongoose\";\n\nlet cached = global.mongoose || {conn: null, promise: null};\n\nexport default async function connectDB(){\n    if(cached.conn) return cached.conn;\n    if(!cached.promise){\n        cached.promise = mongoose.connect(process.env.MONGODB_URI).then((mongoose) => mongoose);\n    }\n    try {\n        cached.conn = await cached.promise;\n    } catch (error) {\n        console.error(\"Error connecting to MongoDB:\", error);\n    }\n    return cached.conn\n}"],"names":[],"mappings":";;;AAAA;;AAEA,IAAI,SAAS,OAAO,QAAQ,IAAI;IAAC,MAAM;IAAM,SAAS;AAAI;AAE3C,eAAe;IAC1B,IAAG,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IAClC,IAAG,CAAC,OAAO,OAAO,EAAC;QACf,OAAO,OAAO,GAAG,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,WAAa;IAClF;IACA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;IAClD;IACA,OAAO,OAAO,IAAI;AACtB","debugId":null}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Abdel/Desktop/ENIAD-ASSISTANT/models/Chat.js"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst ChatSchema = new mongoose.Schema(\n    {\n        name: {type: String, required: true},\n        messages: [\n            {\n                role: {type: String, required: true},\n                content: {type: String, required: true},\n                timestamp: {type: Number, required: true},\n            },\n        ],\n        userId: {type: String, required: true},\n    },\n    {timestamps: true}\n);\n\nconst Chat = mongoose.models.Chat || mongoose.model(\"Chat\", ChatSchema)\n\nexport default Chat;"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,aAAa,IAAI,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAClC;IACI,MAAM;QAAC,MAAM;QAAQ,UAAU;IAAI;IACnC,UAAU;QACN;YACI,MAAM;gBAAC,MAAM;gBAAQ,UAAU;YAAI;YACnC,SAAS;gBAAC,MAAM;gBAAQ,UAAU;YAAI;YACtC,WAAW;gBAAC,MAAM;gBAAQ,UAAU;YAAI;QAC5C;KACH;IACD,QAAQ;QAAC,MAAM;QAAQ,UAAU;IAAI;AACzC,GACA;IAAC,YAAY;AAAI;AAGrB,MAAM,OAAO,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,QAAQ;uCAE7C","debugId":null}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Abdel/Desktop/ENIAD-ASSISTANT/app/api/chat/ai/route.js"],"sourcesContent":["export const maxDuration = 300;\nimport connectDB from \"@/config/db\";\nimport Chat from \"@/models/Chat\";\nimport { getAuth } from \"@clerk/nextjs/server\";\nimport { NextResponse } from \"next/server\";\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({\n    baseURL: 'https://abdellah-ennajari--llama3-openai-compatible-serve.modal.run/v1',\n    apiKey: process.env.MODAL_API_KEY || \"super-secret-key\"\n});\n\nexport async function POST(req) {\n    try {\n        const { userId } = getAuth(req);\n        if (!userId) {\n            return NextResponse.json({ \n                success: false, \n                message: \"Authentication required\" \n            }, { status: 401 });\n        }\n\n        const { chatId, prompt } = await req.json();\n        if (!chatId || !prompt) {\n            return NextResponse.json({ \n                success: false, \n                message: \"Missing required fields\" \n            }, { status: 400 });\n        }\n\n        await connectDB();\n        const chat = await Chat.findOne({ userId, _id: chatId });\n        if (!chat) {\n            return NextResponse.json({ \n                success: false, \n                message: \"Chat not found\" \n            }, { status: 404 });\n        }\n\n        // Add user message\n        const userMessage = {\n            role: \"user\",\n            content: prompt,\n            timestamp: Date.now()\n        };\n        chat.messages.push(userMessage);\n        await chat.save();\n\n        // Prepare messages for AI\n        const messages = [\n            {\n                role: \"system\",\n                content: `Vous êtes l'assistant de l'ENIAD (École Nationale de l'Intelligence Artificielle et Digitale) de Berkane.\n                Répondez toujours en texte brut directement, sans format JSON.\n                Pour les salutations, utilisez ce format exact :\n                \n                \"Bonjour ! Bienvenue à l'École Nationale de l'Intelligence Artificielle et Digitale de Berkane. Je suis ravi de vous aider aujourd'hui.\n\n                Je suis l'assistant virtuel de l'ENIAD et je peux vous renseigner sur divers sujets concernant notre école :\n\n                - Les formations et programmes académiques\n                - Les procédures d'inscription et d'admission\n                - Les services aux étudiants\n                - La vie sur le campus\n                - Les événements et activités\n\n                Voici quelques questions que vous pourriez me poser :\n                • [Question 1]\n                • [Question 2]\n                • [Question 3]\n\n                Adaptez votre réponse à la langue de la question (français, arabe ou anglais).\"\n                `\n            },\n            ...chat.messages.slice(-5).map(msg => ({\n                role: msg.role,\n                content: msg.content\n            }))\n        ];\n\n        // Get AI response\n        const completion = await openai.chat.completions.create({\n            model: \"ahmed-ouka/llama3-8b-eniad-merged-32bit\",\n            messages,\n            temperature: 0.2,\n            max_tokens: 1024\n        });\n\n        const aiMessage = {\n            role: \"assistant\",\n            content: completion.choices[0].message.content,\n            timestamp: Date.now()\n        };\n\n        // Save response\n        chat.messages.push(aiMessage);\n        await chat.save();\n\n        return NextResponse.json({ \n            success: true, \n            data: aiMessage \n        });\n\n    } catch (error) {\n        console.error(\"API Error:\", error);\n        return NextResponse.json({ \n            success: false, \n            error: error.message \n        }, { status: 500 });\n    }\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;AALO,MAAM,cAAc;;;;;;AAO3B,MAAM,SAAS,IAAI,kJAAA,CAAA,UAAM,CAAC;IACtB,SAAS;IACT,QAAQ,QAAQ,GAAG,CAAC,aAAa,IAAI;AACzC;AAEO,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,GAAG,CAAA,GAAA,6KAAA,CAAA,UAAO,AAAD,EAAE;QAC3B,IAAI,CAAC,QAAQ;YACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,SAAS;YACb,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QACzC,IAAI,CAAC,UAAU,CAAC,QAAQ;YACpB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,SAAS;YACb,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,MAAM,CAAA,GAAA,8GAAA,CAAA,UAAS,AAAD;QACd,MAAM,OAAO,MAAM,gHAAA,CAAA,UAAI,CAAC,OAAO,CAAC;YAAE;YAAQ,KAAK;QAAO;QACtD,IAAI,CAAC,MAAM;YACP,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,SAAS;YACb,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,mBAAmB;QACnB,MAAM,cAAc;YAChB,MAAM;YACN,SAAS;YACT,WAAW,KAAK,GAAG;QACvB;QACA,KAAK,QAAQ,CAAC,IAAI,CAAC;QACnB,MAAM,KAAK,IAAI;QAEf,0BAA0B;QAC1B,MAAM,WAAW;YACb;gBACI,MAAM;gBACN,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;gBAoBV,CAAC;YACL;eACG,KAAK,QAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,GAAG,CAAC,CAAA,MAAO,CAAC;oBACnC,MAAM,IAAI,IAAI;oBACd,SAAS,IAAI,OAAO;gBACxB,CAAC;SACJ;QAED,kBAAkB;QAClB,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpD,OAAO;YACP;YACA,aAAa;YACb,YAAY;QAChB;QAEA,MAAM,YAAY;YACd,MAAM;YACN,SAAS,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;YAC9C,WAAW,KAAK,GAAG;QACvB;QAEA,gBAAgB;QAChB,KAAK,QAAQ,CAAC,IAAI,CAAC;QACnB,MAAM,KAAK,IAAI;QAEf,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;QACV;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,OAAO,MAAM,OAAO;QACxB,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ","debugId":null}}]
}